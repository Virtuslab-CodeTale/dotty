[
  {
    "id" : "089815d6-1809-442e-b973-5b15961f8d09",
    "prId" : 12885,
    "prUrl" : "https://github.com/lampepfl/dotty/pull/12885#pullrequestreview-697786408",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "3c93bbe9-605c-4fde-8041-2fec0ef4c7a4",
        "parentId" : null,
        "authorId" : "afb48bac-8340-43c2-a53e-e420ce6ddd13",
        "body" : "Basically copied from ExtractSemanticDB\r\nIt also removes the assertion on `span`, because when we generate a dummy symbol for `RefinedType`, those symbols don't have position information.\r\n\r\n```diff\r\n def localIdx(sym: Symbol)(using Context): Int =\r\n   val startPos =\r\n-    assert(sym.span.exists, s\"$sym should have a span\")\r\n-    sym.span.start\r\n+    if sym.span.exists then Some(sym.span.start) else None\r\n+    // assert(sym.span.exists, s\"$sym should have a span\")\r\n   @tailrec\r\n   def computeLocalIdx(sym: Symbol): Int = locals get sym match\r\n     case Some(idx) => idx\r\n-    case None      => symsAtOffset(startPos).find(_.name == sym.name) match\r\n+    case None      => (for {\r\n+      pos <- startPos\r\n+      samePosSyms <- symsAtOffset.get(pos)\r\n+      sameName <- samePosSyms.find(_.name == sym.name)\r\n+    } yield sameName) match\r\n       case Some(other) => computeLocalIdx(other)\r\n       case None =>\r\n         val idx = nextLocalIdx\r\n         nextLocalIdx += 1\r\n         locals(sym) = idx\r\n-        symsAtOffset(startPos) += sym\r\n+        startPos.foreach(pos => symsAtOffset(pos) += sym)\r\n         idx\r\n   end computeLocalIdx\r\n   computeLocalIdx(sym)\r\n```",
        "createdAt" : "2021-06-24T17:34:21Z",
        "updatedAt" : "2021-06-24T18:15:58Z",
        "lastEditedBy" : "afb48bac-8340-43c2-a53e-e420ce6ddd13",
        "tags" : [
        ]
      },
      {
        "id" : "d001390c-6635-4f26-b7fb-c4a2bb91eab3",
        "parentId" : "3c93bbe9-605c-4fde-8041-2fec0ef4c7a4",
        "authorId" : "b0a3e0ce-5278-4dad-8026-49b4b4041725",
        "body" : "Do we need to remove the assert on span now?",
        "createdAt" : "2021-07-01T13:37:45Z",
        "updatedAt" : "2021-07-01T14:07:32Z",
        "lastEditedBy" : "b0a3e0ce-5278-4dad-8026-49b4b4041725",
        "tags" : [
        ]
      },
      {
        "id" : "8a363083-556b-4f91-8ae0-590bbf017d8e",
        "parentId" : "3c93bbe9-605c-4fde-8041-2fec0ef4c7a4",
        "authorId" : "afb48bac-8340-43c2-a53e-e420ce6ddd13",
        "body" : "Sry for confustion, I reverted https://github.com/lampepfl/dotty/pull/12885/commits/58fd3d581bba5a5190d7a0f6a1f5ab538b1b8612 because it's not already needed üëç ",
        "createdAt" : "2021-07-02T02:58:09Z",
        "updatedAt" : "2021-07-02T02:58:09Z",
        "lastEditedBy" : "afb48bac-8340-43c2-a53e-e420ce6ddd13",
        "tags" : [
        ]
      }
    ],
    "commit" : "056f4a416d444f58a9f2e0ae2f4afc19cb56a95e",
    "line" : 121,
    "diffHunk" : "@@ -1,1 +119,123 @@     *  the same starting position have the same index.\n     */\n    def localIdx(sym: Symbol)(using Context): Int =\n      val startPos =\n        // assert(sym.span.exists, s\"$sym should have a span\")"
  },
  {
    "id" : "a7d00324-83c6-4a0f-919e-301befdcc5a4",
    "prId" : 12885,
    "prUrl" : "https://github.com/lampepfl/dotty/pull/12885#pullrequestreview-692033783",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "d37b1297-93b5-46e1-9be1-3d655d15f68a",
        "parentId" : null,
        "authorId" : "afb48bac-8340-43c2-a53e-e420ce6ddd13",
        "body" : "Extracted semantic symbol builder logics from `ExtractSemanticDB`.",
        "createdAt" : "2021-06-24T17:35:16Z",
        "updatedAt" : "2021-06-24T18:15:58Z",
        "lastEditedBy" : "afb48bac-8340-43c2-a53e-e420ce6ddd13",
        "tags" : [
        ]
      }
    ],
    "commit" : "056f4a416d444f58a9f2e0ae2f4afc19cb56a95e",
    "line" : 1,
    "diffHunk" : "@@ -1,1 +-1,3 @@package dotty.tools\npackage dotc\npackage semanticdb"
  }
]